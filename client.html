<!DOCTYPE html>
<html>
   <head>
     <link rel="stylesheet" type="text/css" href="chat.css">
      <script src="/socket.io/socket.io.js"></script>
      <script type ="text/javascript">
      //var users = [];
      var currentuser;
      var socketio = io.connect();
      socketio.on("message_to_client",function(data) {
         //Append an HR thematic break and the escaped HTML of the new message
         console.log(data);
         document.getElementById("chatlog").appendChild(document.createElement("hr"));
         document.getElementById("chatlog").appendChild(document.createTextNode(data['messagewriter'] + ": " + data['message']));
      });
      socketio.on("user_entering", function(data) {
        var x = document.createElement("p");
        var users = data['newuser'];
        console.log(users);
        document.getElementById("currentusers").innerHTML = createString(users);
        //document.getElementById("currentusers").appendChild(document.createTextNode(userstring));
      });
      socketio.on("change_message", function(data) {
        console.log(data["roomlist"]);
        console.log(data["message"]);
        document.getElementById("currentusers").innerHTML = createString(data["roomlist"]);
        document.getElementById("chatlog").appendChild(document.createElement("hr"));
        document.getElementById("chatlog").appendChild(document.createTextNode(data["message"]));
      });

      function createString(list) {
        var userstring = "";
        for (var key in list) {
          if (list.hasOwnProperty(key)) {

            console.log(key + " -> " + list[key]);
            userstring += list[key] + ", ";
          }
        }
        console.log(userstring);
        return userstring
      }
      function sendMessage(){
         var msg = document.getElementById("message_input").value;
         var usr = currentuser;
         //console.log(usr);
         socketio.emit("message_to_server", {message:msg, messagewriter:usr});
      }
      function enterRoom(){
        var user = document.getElementById("name").value;
        currentuser = user;
        socketio.emit("user_entering", {newuser:user});
      }

      </script>
   </head>
   <body>
     <div id="userlist">
     <input type="text" id="name">
     <button onclick="enterRoom()">Enter room</button>
     <div id="currentusers"></div>
   </div>
   <hr>
   <div id="messaging">
      <input type="text" id="message_input"/>
      <button onclick="sendMessage()">send</button>
      <div id="chatlog"></div>
    </div>
   </body>
</html>
